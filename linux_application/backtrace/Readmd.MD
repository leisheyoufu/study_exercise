pscp -pw 123456 -r D:\Projects\study_exercise\linux_application\backtrace root@192.168.126.141:/root/projects/study_exercise/linux_application/
gcc -g -rdynamic main.cpp -o main

## Theroy principle
-rdynamic 却是一个 连接选项 ，它将指示连接器把所有符号（而不仅仅只是程序已使用到的外部符号）都添加到动态符号表（即.dynsym表）里，以便那些通过 dlopen() 或 backtrace() （这一系列函数使用.dynsym表内符号）这样的函数使用。

1，-g选项新添加的是调试信息（一系列.debug_xxx段），被相关调试工具，比如gdb使用，可以被strip掉。

2，-rdynamic选项新添加的是动态连接符号信息，用于动态连接功能，比如dlopen()系列函数、backtrace()系列函数使用，不能被strip掉，即强制strip将导致程序无法执行：

strip获得到的信息，简单的说就是给文件脱掉外衣，具体就是从特定文件中剥掉一些符号信息和调试信息，使文件变小。

## Reference
backtrace, backtrace_symbols, backtrace_symbols_fd: https://www.cnblogs.com/mickole/p/3246702.html
How to automatically generate a stacktrace when my program crashes: https://stackoverflow.com/questions/77005/how-to-automatically-generate-a-stacktrace-when-my-program-crashes


## Readelf

### Compile without -rdynamic
gcc -g main.cpp -o main
Only symbols used by program will be included
```
readelf -s main
Symbol table '.dynsym' contains 13 entries: // cl 13
   Num:    Value          Size Type    Bind   Vis      Ndx Name
     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND
     1: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND backtrace_symbols_fd@GLIBC_2.2.5 (2)
     2: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_deregisterTMCloneTab
     3: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND backtrace@GLIBC_2.2.5 (2)
     4: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND printf@GLIBC_2.2.5 (2)
     5: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __libc_start_main@GLIBC_2.2.5 (2)
     6: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND signal@GLIBC_2.2.5 (2)
     7: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND fprintf@GLIBC_2.2.5 (2)
     8: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__
     9: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND exit@GLIBC_2.2.5 (2)
    10: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_registerTMCloneTable
    11: 0000000000000000     0 FUNC    WEAK   DEFAULT  UND __cxa_finalize@GLIBC_2.2.5 (2)
    12: 0000000000201020     8 OBJECT  GLOBAL DEFAULT   24 stderr@GLIBC_2.2.5 (2)

Symbol table '.symtab' contains 78 entries:
   Num:    Value          Size Type    Bind   Vis      Ndx Name
     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND
     1: 0000000000000238     0 SECTION LOCAL  DEFAULT    1
     2: 0000000000000254     0 SECTION LOCAL  DEFAULT    2
     3: 0000000000000274     0 SECTION LOCAL  DEFAULT    3
     4: 0000000000000298     0 SECTION LOCAL  DEFAULT    4
     5: 00000000000002c0     0 SECTION LOCAL  DEFAULT    5
     6: 00000000000003f8     0 SECTION LOCAL  DEFAULT    6
     7: 00000000000004b0     0 SECTION LOCAL  DEFAULT    7
     8: 00000000000004d0     0 SECTION LOCAL  DEFAULT    8
     9: 00000000000004f0     0 SECTION LOCAL  DEFAULT    9
    10: 00000000000005c8     0 SECTION LOCAL  DEFAULT   10
    11: 0000000000000658     0 SECTION LOCAL  DEFAULT   11
    12: 0000000000000670     0 SECTION LOCAL  DEFAULT   12
    13: 00000000000006e0     0 SECTION LOCAL  DEFAULT   13
    14: 00000000000006f0     0 SECTION LOCAL  DEFAULT   14
    15: 0000000000000954     0 SECTION LOCAL  DEFAULT   15
    16: 0000000000000960     0 SECTION LOCAL  DEFAULT   16
    17: 000000000000097c     0 SECTION LOCAL  DEFAULT   17
    18: 00000000000009d8     0 SECTION LOCAL  DEFAULT   18
    19: 0000000000200d90     0 SECTION LOCAL  DEFAULT   19
    20: 0000000000200d98     0 SECTION LOCAL  DEFAULT   20
    21: 0000000000200da0     0 SECTION LOCAL  DEFAULT   21
    22: 0000000000200f90     0 SECTION LOCAL  DEFAULT   22
    23: 0000000000201000     0 SECTION LOCAL  DEFAULT   23
    24: 0000000000201020     0 SECTION LOCAL  DEFAULT   24
    25: 0000000000000000     0 SECTION LOCAL  DEFAULT   25
    26: 0000000000000000     0 SECTION LOCAL  DEFAULT   26
    27: 0000000000000000     0 SECTION LOCAL  DEFAULT   27
    28: 0000000000000000     0 SECTION LOCAL  DEFAULT   28
    29: 0000000000000000     0 SECTION LOCAL  DEFAULT   29
    30: 0000000000000000     0 SECTION LOCAL  DEFAULT   30
    31: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS crtstuff.c
    32: 0000000000000720     0 FUNC    LOCAL  DEFAULT   14 deregister_tm_clones
    33: 0000000000000760     0 FUNC    LOCAL  DEFAULT   14 register_tm_clones
    34: 00000000000007b0     0 FUNC    LOCAL  DEFAULT   14 __do_global_dtors_aux
    35: 0000000000201028     1 OBJECT  LOCAL  DEFAULT   24 completed.7698
    36: 0000000000200d98     0 OBJECT  LOCAL  DEFAULT   20 __do_global_dtors_aux_fin
    37: 00000000000007f0     0 FUNC    LOCAL  DEFAULT   14 frame_dummy
    38: 0000000000200d90     0 OBJECT  LOCAL  DEFAULT   19 __frame_dummy_init_array_
    39: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS main.cpp
    40: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS crtstuff.c
    41: 0000000000000b5c     0 OBJECT  LOCAL  DEFAULT   18 __FRAME_END__
    42: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS
    43: 0000000000200d98     0 NOTYPE  LOCAL  DEFAULT   19 __init_array_end
    44: 0000000000200da0     0 OBJECT  LOCAL  DEFAULT   21 _DYNAMIC
    45: 0000000000200d90     0 NOTYPE  LOCAL  DEFAULT   19 __init_array_start
    46: 000000000000097c     0 NOTYPE  LOCAL  DEFAULT   17 __GNU_EH_FRAME_HDR
    47: 0000000000200f90     0 OBJECT  LOCAL  DEFAULT   22 _GLOBAL_OFFSET_TABLE_
    48: 0000000000000950     2 FUNC    GLOBAL DEFAULT   14 __libc_csu_fini
    49: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND backtrace_symbols_fd@@GLI
    50: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_deregisterTMCloneTab
    51: 0000000000201000     0 NOTYPE  WEAK   DEFAULT   23 data_start
    52: 0000000000201010     0 NOTYPE  GLOBAL DEFAULT   23 _edata
    53: 00000000000007fa   114 FUNC    GLOBAL DEFAULT   14 _Z7handleri
    54: 0000000000000954     0 FUNC    GLOBAL DEFAULT   15 _fini
    55: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND backtrace@@GLIBC_2.2.5
    56: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND printf@@GLIBC_2.2.5
    57: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __libc_start_main@@GLIBC_
    58: 0000000000201000     0 NOTYPE  GLOBAL DEFAULT   23 __data_start
    59: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND signal@@GLIBC_2.2.5
    60: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND fprintf@@GLIBC_2.2.5
    61: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__
    62: 0000000000201008     0 OBJECT  GLOBAL HIDDEN    23 __dso_handle
    63: 0000000000000960     4 OBJECT  GLOBAL DEFAULT   16 _IO_stdin_used
    64: 00000000000008e0   101 FUNC    GLOBAL DEFAULT   14 __libc_csu_init
    65: 0000000000201030     0 NOTYPE  GLOBAL DEFAULT   24 _end
    66: 00000000000006f0    43 FUNC    GLOBAL DEFAULT   14 _start
    67: 0000000000201010     0 NOTYPE  GLOBAL DEFAULT   24 __bss_start
    68: 00000000000008b0    44 FUNC    GLOBAL DEFAULT   14 main
    69: 00000000000008a4    12 FUNC    GLOBAL DEFAULT   14 _Z3foov
    70: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND exit@@GLIBC_2.2.5
    71: 0000000000201010     0 OBJECT  GLOBAL HIDDEN    23 __TMC_END__
    72: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_registerTMCloneTable
    73: 0000000000000898    12 FUNC    GLOBAL DEFAULT   14 _Z3barv
    74: 000000000000086c    44 FUNC    GLOBAL DEFAULT   14 _Z3bazv
    75: 0000000000000000     0 FUNC    WEAK   DEFAULT  UND __cxa_finalize@@GLIBC_2.2
    76: 0000000000000658     0 FUNC    GLOBAL DEFAULT   11 _init
    77: 0000000000201020     8 OBJECT  GLOBAL DEFAULT   24 stderr@@GLIBC_2.2.5
```
strip main   // delete symbol table in main
```
root@ubuntu1:~/projects/study_exercise/linux_application/exception# strip main
root@ubuntu1:~/projects/study_exercise/linux_application/exception# readelf -s main

Symbol table '.dynsym' contains 13 entries:
   Num:    Value          Size Type    Bind   Vis      Ndx Name
     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND
     1: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND backtrace_symbols_fd@GLIBC_2.2.5 (2)
     2: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_deregisterTMCloneTab
     3: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND backtrace@GLIBC_2.2.5 (2)
     4: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND printf@GLIBC_2.2.5 (2)
     5: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __libc_start_main@GLIBC_2.2.5 (2)
     6: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND signal@GLIBC_2.2.5 (2)
     7: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND fprintf@GLIBC_2.2.5 (2)
     8: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__
     9: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND exit@GLIBC_2.2.5 (2)
    10: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_registerTMCloneTable
    11: 0000000000000000     0 FUNC    WEAK   DEFAULT  UND __cxa_finalize@GLIBC_2.2.5 (2)
    12: 0000000000201020     8 OBJECT  GLOBAL DEFAULT   24 stderr@GLIBC_2.2.5 (2)
```

### Compile with -rdynamic
gcc -g -O0 -rdynamic main.cpp -o main.rd
All of the symbols used by program will be included
```
readelf -s main.rd
Symbol table '.dynsym' contains 29 entries:  // cl: 29
   Num:    Value          Size Type    Bind   Vis      Ndx Name
     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND
     1: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND backtrace_symbols_fd@GLIBC_2.2.5 (2)
     2: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_deregisterTMCloneTab
     3: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND backtrace@GLIBC_2.2.5 (2)
     4: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND printf@GLIBC_2.2.5 (2)
     5: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __libc_start_main@GLIBC_2.2.5 (2)
     6: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND signal@GLIBC_2.2.5 (2)
     7: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND fprintf@GLIBC_2.2.5 (2)
     8: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__
     9: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND exit@GLIBC_2.2.5 (2)
    10: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_registerTMCloneTable
    11: 0000000000000000     0 FUNC    WEAK   DEFAULT  UND __cxa_finalize@GLIBC_2.2.5 (2)
    12: 0000000000000a9a   114 FUNC    GLOBAL DEFAULT   14 _Z7handleri
    13: 0000000000000bf4     0 FUNC    GLOBAL DEFAULT   15 _fini
    14: 0000000000000b50    44 FUNC    GLOBAL DEFAULT   14 main
    15: 0000000000000b44    12 FUNC    GLOBAL DEFAULT   14 _Z3foov
    16: 00000000000008f0     0 FUNC    GLOBAL DEFAULT   11 _init
    17: 0000000000202010     0 NOTYPE  GLOBAL DEFAULT   24 __bss_start
    18: 0000000000000c00     4 OBJECT  GLOBAL DEFAULT   16 _IO_stdin_used
    19: 0000000000202030     0 NOTYPE  GLOBAL DEFAULT   24 _end
    20: 0000000000202000     0 NOTYPE  GLOBAL DEFAULT   23 __data_start
    21: 0000000000000b38    12 FUNC    GLOBAL DEFAULT   14 _Z3barv
    22: 0000000000202010     0 NOTYPE  GLOBAL DEFAULT   23 _edata
    23: 0000000000202020     8 OBJECT  GLOBAL DEFAULT   24 stderr@GLIBC_2.2.5 (2)
    24: 0000000000000bf0     2 FUNC    GLOBAL DEFAULT   14 __libc_csu_fini
    25: 0000000000000b80   101 FUNC    GLOBAL DEFAULT   14 __libc_csu_init
    26: 0000000000000990    43 FUNC    GLOBAL DEFAULT   14 _start
    27: 0000000000202000     0 NOTYPE  WEAK   DEFAULT   23 data_start
    28: 0000000000000b0c    44 FUNC    GLOBAL DEFAULT   14 _Z3bazv

Symbol table '.symtab' contains 78 entries:
   Num:    Value          Size Type    Bind   Vis      Ndx Name
     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND
     1: 0000000000000238     0 SECTION LOCAL  DEFAULT    1
     2: 0000000000000254     0 SECTION LOCAL  DEFAULT    2
     3: 0000000000000274     0 SECTION LOCAL  DEFAULT    3
     4: 0000000000000298     0 SECTION LOCAL  DEFAULT    4
     5: 0000000000000340     0 SECTION LOCAL  DEFAULT    5
     6: 00000000000005f8     0 SECTION LOCAL  DEFAULT    6
     7: 0000000000000728     0 SECTION LOCAL  DEFAULT    7
     8: 0000000000000768     0 SECTION LOCAL  DEFAULT    8
     9: 0000000000000788     0 SECTION LOCAL  DEFAULT    9
    10: 0000000000000860     0 SECTION LOCAL  DEFAULT   10
    11: 00000000000008f0     0 SECTION LOCAL  DEFAULT   11
    12: 0000000000000910     0 SECTION LOCAL  DEFAULT   12
    13: 0000000000000980     0 SECTION LOCAL  DEFAULT   13
    14: 0000000000000990     0 SECTION LOCAL  DEFAULT   14
    15: 0000000000000bf4     0 SECTION LOCAL  DEFAULT   15
    16: 0000000000000c00     0 SECTION LOCAL  DEFAULT   16
    17: 0000000000000c1c     0 SECTION LOCAL  DEFAULT   17
    18: 0000000000000c78     0 SECTION LOCAL  DEFAULT   18
    19: 0000000000201d90     0 SECTION LOCAL  DEFAULT   19
    20: 0000000000201d98     0 SECTION LOCAL  DEFAULT   20
    21: 0000000000201da0     0 SECTION LOCAL  DEFAULT   21
    22: 0000000000201f90     0 SECTION LOCAL  DEFAULT   22
    23: 0000000000202000     0 SECTION LOCAL  DEFAULT   23
    24: 0000000000202020     0 SECTION LOCAL  DEFAULT   24
    25: 0000000000000000     0 SECTION LOCAL  DEFAULT   25
    26: 0000000000000000     0 SECTION LOCAL  DEFAULT   26
    27: 0000000000000000     0 SECTION LOCAL  DEFAULT   27
    28: 0000000000000000     0 SECTION LOCAL  DEFAULT   28
    29: 0000000000000000     0 SECTION LOCAL  DEFAULT   29
    30: 0000000000000000     0 SECTION LOCAL  DEFAULT   30
    31: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS crtstuff.c
    32: 00000000000009c0     0 FUNC    LOCAL  DEFAULT   14 deregister_tm_clones
    33: 0000000000000a00     0 FUNC    LOCAL  DEFAULT   14 register_tm_clones
    34: 0000000000000a50     0 FUNC    LOCAL  DEFAULT   14 __do_global_dtors_aux
    35: 0000000000202028     1 OBJECT  LOCAL  DEFAULT   24 completed.7698
    36: 0000000000201d98     0 OBJECT  LOCAL  DEFAULT   20 __do_global_dtors_aux_fin
    37: 0000000000000a90     0 FUNC    LOCAL  DEFAULT   14 frame_dummy
    38: 0000000000201d90     0 OBJECT  LOCAL  DEFAULT   19 __frame_dummy_init_array_
    39: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS main.cpp
    40: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS crtstuff.c
    41: 0000000000000dfc     0 OBJECT  LOCAL  DEFAULT   18 __FRAME_END__
    42: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS
    43: 0000000000201d98     0 NOTYPE  LOCAL  DEFAULT   19 __init_array_end
    44: 0000000000202008     0 OBJECT  LOCAL  DEFAULT   23 __dso_handle
    45: 0000000000201da0     0 OBJECT  LOCAL  DEFAULT   21 _DYNAMIC
    46: 0000000000201d90     0 NOTYPE  LOCAL  DEFAULT   19 __init_array_start
    47: 0000000000000c1c     0 NOTYPE  LOCAL  DEFAULT   17 __GNU_EH_FRAME_HDR
    48: 0000000000202010     0 OBJECT  LOCAL  DEFAULT   23 __TMC_END__
    49: 0000000000201f90     0 OBJECT  LOCAL  DEFAULT   22 _GLOBAL_OFFSET_TABLE_
    50: 0000000000000bf0     2 FUNC    GLOBAL DEFAULT   14 __libc_csu_fini
    51: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND backtrace_symbols_fd@@GLI
    52: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_deregisterTMCloneTab
    53: 0000000000202000     0 NOTYPE  WEAK   DEFAULT   23 data_start
    54: 0000000000202010     0 NOTYPE  GLOBAL DEFAULT   23 _edata
    55: 0000000000000a9a   114 FUNC    GLOBAL DEFAULT   14 _Z7handleri
    56: 0000000000000bf4     0 FUNC    GLOBAL DEFAULT   15 _fini
    57: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND backtrace@@GLIBC_2.2.5
    58: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND printf@@GLIBC_2.2.5
    59: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __libc_start_main@@GLIBC_
    60: 0000000000202000     0 NOTYPE  GLOBAL DEFAULT   23 __data_start
    61: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND signal@@GLIBC_2.2.5
    62: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND fprintf@@GLIBC_2.2.5
    63: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__
    64: 0000000000000c00     4 OBJECT  GLOBAL DEFAULT   16 _IO_stdin_used
    65: 0000000000000b80   101 FUNC    GLOBAL DEFAULT   14 __libc_csu_init
    66: 0000000000202030     0 NOTYPE  GLOBAL DEFAULT   24 _end
    67: 0000000000000990    43 FUNC    GLOBAL DEFAULT   14 _start
    68: 0000000000202010     0 NOTYPE  GLOBAL DEFAULT   24 __bss_start
    69: 0000000000000b50    44 FUNC    GLOBAL DEFAULT   14 main
    70: 0000000000000b44    12 FUNC    GLOBAL DEFAULT   14 _Z3foov
    71: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND exit@@GLIBC_2.2.5
    72: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_registerTMCloneTable
    73: 0000000000000b38    12 FUNC    GLOBAL DEFAULT   14 _Z3barv
    74: 0000000000000b0c    44 FUNC    GLOBAL DEFAULT   14 _Z3bazv
    75: 0000000000000000     0 FUNC    WEAK   DEFAULT  UND __cxa_finalize@@GLIBC_2.2
    76: 00000000000008f0     0 FUNC    GLOBAL DEFAULT   11 _init
    77: 0000000000202020     8 OBJECT  GLOBAL DEFAULT   24 stderr@@GLIBC_2.2.5
```