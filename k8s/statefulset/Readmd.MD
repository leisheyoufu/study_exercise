## Start zookeeper statefulset
kubectl create ns loch
mkdir -p /mnt/data
kubectl create -f zookeeper.yml

## zk command
./bin/zkCli.sh -server <ip>:2181 ls / 
./bin/zkCli.sh -server zookeeperserver:2181 // will get into interactive mode

### in interactive mod
create /zk "myData"
ls /zk
get /zk
set /zk "zsl"
delete /zk

### zk server status
./bin/zkServer.sh status
```
ZooKeeper JMX enabled by default
Using config: /opt/zookeeper-3.4.10/bin/../conf/zoo.cfg
Mode: follower
```

## Useful scripts for kubernetes statefulset
根据shell取得domain, server count, 在配置文件中加入server列表
```
server.1=zookeeper-0.<ns>.svc.cluster.local:2888:3888
server.2=zookeeper-1.<ns>.svc.cluster.local:2888:3888
server.3=zookeeper-2.<ns>.svc.cluster.local:2888:3888
```
cat start-zookeeper
```
function print_servers() {
    for (( i=1; i<=$SERVERS; i++ ))
    do
        echo "server.$i=$NAME-$((i-1)).$DOMAIN:$SERVER_PORT:$ELECTION_PORT"
    done
}

function create_config() {
    rm -f $CONFIG_FILE
    echo "#This file was autogenerated DO NOT EDIT" >> $CONFIG_FILE
    echo "clientPort=$CLIENT_PORT" >> $CONFIG_FILE
    echo "dataDir=$DATA_DIR" >> $CONFIG_FILE
    echo "dataLogDir=$DATA_LOG_DIR" >> $CONFIG_FILE
    echo "tickTime=$TICK_TIME" >> $CONFIG_FILE
    echo "initLimit=$INIT_LIMIT" >> $CONFIG_FILE
    echo "syncLimit=$SYNC_LIMIT" >> $CONFIG_FILE
    echo "maxClientCnxns=$MAX_CLIENT_CNXNS" >> $CONFIG_FILE
    echo "minSessionTimeout=$MIN_SESSION_TIMEOUT" >> $CONFIG_FILE
    echo "maxSessionTimeout=$MAX_SESSION_TIMEOUT" >> $CONFIG_FILE
    echo "autopurge.snapRetainCount=$SNAP_RETAIN_COUNT" >> $CONFIG_FILE
    echo "autopurge.purgeInteval=$PURGE_INTERVAL" >> $CONFIG_FILE
     if [ $SERVERS -gt 1 ]; then
        print_servers >> $CONFIG_FILE
    fi
    cat $CONFIG_FILE >&2
}
```

## Refefence
[kubernetes zookeeper](https://kubernetes.io/docs/tutorials/stateful-application/zookeeper/)
[github kubernetes zookeeper docker file ](https://github.com/kow3ns/kubernetes-zookeeper)